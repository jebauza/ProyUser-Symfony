{%extends '::base.html.twig'%}

{% block title %}{{ parent() }}-Marcaciones{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('bundles/rmsmarcaciones/css/marcaciones.css') }}">
{% endblock %}


{% block activemarcaciones %}class="active"{% endblock %}
{% block body %}




    <div class="bs-docs-section container">


    <div class="row">
    <div class="col-xs-3" id="lateral">
        <div id="filtro" class="panel col-xs-12">
            <div class="panel-heading "><span class="glyphicon glyphicon-search"></span>Filtro</div>

            <form role="form" class="form-horizontal" method="post" action="{{ path('rms_marcaciones_busqueda_mes_anno') }}">
                <div class="form-group ">
                    {% set anno,annIniMarc,mesEscojido,mesI,mesF = arrDatosInformativos['datosAnnoMarcacion']['annoEscojido'],arrDatosInformativos['datosAnnoMarcacion']['annoIni'],arrDatosInformativos['datosAnnoMarcacion']['mesEscojido'],arrDatosInformativos['datosAnnoMarcacion']['meses']['ini'],arrDatosInformativos['datosAnnoMarcacion']['meses']['fin'] %}
                    {% set arrMeses = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"]  %}
                    <input type="hidden" id="meses" value="{{ arrDatosInformativos['datosAnnoMarcacion']['textoPeriodoMarcaciones'] }}" />
                    <label for="sel2 " class="col-sm-3">AÃ±o:</label>
                    <select class="form-control col-sm-9 input-sm" id="sel2" name="_anno">
                        <option value="{{ anno }}">{{ anno }}</option>
                        {% for i in "now"|date("Y")..annIniMarc if i != anno%}
                           <option value="{{ i }}">{{ i }}</option>
                        {% endfor %}
                    </select>

                    <td> <label class="col-sm-3"  for="sel1">Mes:</label>
                        <select class="form-control  col-sm-9 input-sm" id="sel1" name="_mes">
                            <option value="{{ mesEscojido }}">{{ arrMeses[mesEscojido-1] }}</option>
                            {% for j in mesI..mesF if j != mesEscojido*1%}
                                {% set mesNum = j*1 %}
                                {% if mesNum < 10 %}
                                    {% set mesNum = '0'~j*1 %}
                                {% endif %}
                                <option value="{{ mesNum }}">{{ arrMeses[j*1-1] }}</option>
                            {% endfor %}
                        </select></td>

                </div>
                <button type="submit" class="btn btn-default right">Buscar</button>
            </form>

        </div>

        <div id="reporte" class="panel col-xs-12 ">
            <div class="panel-heading "><span class="glyphicon glyphicon-stats"></span>Reporte</div>
            <dl class="dl-horizontal">
                <dt>Dias laborables:</dt>
                <dd><em>{{ arrDatosInformativos['dias_laborables'] }}</em></dd>
                <dt>Dias trabajados</dt>
                <dd><em>{{ arrDatosInformativos['dias_trabajados'] }}</em></dd>
                <dt>Dias feriados:</dt>
                <dd>{{ arrDatosInformativos['dias_feriados'] }}</dd>
                <dt>Ausencias:</dt>
                <dd>{{ arrDatosInformativos['ausencias'] }}</dd>
                <dt>Impuntualidades:</dt>
                <dd><em>{{ arrDatosInformativos['Impuntualidades'] }}</em></dd>
                <dt>Viatico total:</dt>
                <dd><em>{{ arrDatosInformativos['dias_laborables']*0.6 }} cuc</em></dd>
                <dt>Viatico a cobrar:</dt>
                <dd class="text-danger"> <em>{{ arrDatosInformativos['dias_trabajados']*0.6 }} cuc</em></dd>
            </dl>
        </div>

    </div>





{#PRIEBA PROGRAMAR AQUI------------------------------------------------------------------#}

        <div class="col-xs-9 " >
            <div class="panel col-xs-12 ">
                <div class="panel-heading ">Reporte de marcaciones del mes de {{arrDatosAnnoMes['mes']['nombre']}} del {{arrDatosAnnoMes['anno']}}</div>
                <div class="calendario">
                    <table class="table table-bordered  ">

                        <thead>
                        <tr>
                            <th>Sem</th>
                            <th>Lunes</th>
                            <th>Martes</th>
                            <th>Miecoles</th>
                            <th>Jueves</th>
                            <th>Viernes</th>
                            <th>Sabado</th>
                            <th>Domingo</th>
                        </tr>
                        </thead>
                        <tbody>

                        {% set arrFeriados = {'0101': true,'0102': true,'0501': true,'0725': true,'0726': true,'0727': true,'1010': true,'1225': true,'1231': true} %}
                        {% set numDiasdibujado = 0 %}
                        {% set diaSemanaPrimerDiaDelMes = arrDatosAnnoMes['diaSemanaPrimerDiaDelMes'] %}
                        {% set cantDiasMes = arrDatosAnnoMes['cant_dias_mes'] %}
                        {% set cantDiasMarcados = arrDatosInformativos['dias_trabajados'] %}
                        {% set fecha = '' %}
                        {% for i in 1..6 if numDiasdibujado < cantDiasMes %}
                            <tr class="" >
                                <td>{{ i }}</td>
                                {% for j in 1..7 %}
                                   {% if (j<diaSemanaPrimerDiaDelMes and i==1)or(numDiasdibujado >= cantDiasMes)%}
                                       <td></td>
                                   {% else %}

                                       {% set numDiasdibujado=numDiasdibujado+1 %}
                                       {% set fecha = arrDatosAnnoMes['codigo']~numDiasdibujado %}
                                       {% if numDiasdibujado<10%}
                                           {% set fecha = arrDatosAnnoMes['codigo']~"0"~numDiasdibujado %}
                                       {% endif %}

                                {% autoescape true %}
                                  {% if arrMarcPorFecha[fecha]['tipoCasilla'] is defined %}
                                       {% if arrMarcPorFecha[fecha]['tipoCasilla']=="conMarcacionesERROR" %}
                                           <td class="alert alert-danger " ><p   class="dia"><em >{{ numDiasdibujado }}</em></p><p>{{ arrMarcPorFecha[fecha]['marcaciones'][0]['hora']}}<br/>{{ arrMarcPorFecha[fecha]['marcaciones'][arrMarcPorFecha[fecha]['marcaciones'] | length - 1]['hora'] }}<span class="pull-right glyphicon glyphicon-bell"></span></p></td>
                                       {% elseif arrMarcPorFecha[fecha]['tipoCasilla']=="conMarcacionesOK" %}
                                           <td><p  class="dia"><em >{{ numDiasdibujado }}</em></p><p>{{ arrMarcPorFecha[fecha]['marcaciones'][0]['hora']}}<br/>{{ arrMarcPorFecha[fecha]['marcaciones'][arrMarcPorFecha[fecha]['marcaciones'] | length - 1]['hora'] }}</p></td>
                                       {% elseif arrMarcPorFecha[fecha]['tipoCasilla']=="sabado_domingo" %}
                                           <td><p  class="dia"><em >{{ numDiasdibujado }}</em></p></td>
                                       {% elseif arrMarcPorFecha[fecha]['tipoCasilla']=="feriado" %}
                                           <td class="alert alert-info"><p  class="dia"><em>{{ numDiasdibujado }}</em></p><p>Feriado</p></td>
                                       {% elseif arrMarcPorFecha[fecha]['tipoCasilla']=="ausencia" %}
                                           <td class="alert alert-warning"><p  class="dia"><em >{{ numDiasdibujado }}</em></p><p>Ausencia</p></td>
                                       {% else %}
                                           <td><p  class="dia"><em >{{ numDiasdibujado }}</em></p></td>
                                       {% endif %}
                                  {% else %}
                                      <td><p  class="dia"><em >{{ numDiasdibujado }}</em></p></td>
                                  {% endif %}
                                {% endautoescape %}




                                   {% endif %}

                                {% endfor %}
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>

                </div>
                <div id="leyenda">
                    <ul class="list-inline">
                        <li>Hoy<div class="alert-success"></div> </li>
                        <li>Feriado<div class="alert-info"></div></li>
                        <li>Impuntualidades<div class="alert-danger"></div></li>
                        <li>Ausencias<div class="alert-warning"></div></li>
                    </ul>
                </div>
            </div>

        </div>
{#----------------------------------------------------------------------------------------------------------------#}







    </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('bundles/rmsmarcaciones/js/marcaciones.js') }}"></script>
{% endblock %}
